<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http=equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewpoint" content="width = device-width, initial-scale = 1">
<title>Citibike Angels Route Calculator</title>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

</head>
<body>
<div class="container">
<div class="nav">
<p>Choose Source:</p>
#form_src
<p>Choose Destination:</p>
#form_dest
<p><button id="get_routes_button" onclick="getRoutes()">GetRoutes</button></p>
</div>
<div id="result_div">
<iframe id="result_iframe" width=1000 height=600>
 <p>Your web browser does no support iframes</p>
</iframe>
</div>
<script>
function getCurrentLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(radioPosition, radioError);
  } else {
    disableCurrentLocation("Location information not supported.")
  }
}

function disableCurrentLocation(message) {
  var radio  = document.getElementById("source_current_location");
  var home  = document.getElementById("source_home");
  radio.disabled = true;
  radio.labels[0].innerText = "Current Location is not available:'" + message + "'";
  radio.checked = false;
  home.checked = true;
  var radio_dest  = document.getElementById("dest_current_location");
  var home_dest  = document.getElementById("dest_home");
  radio_dest.disabled = true;
  radio_dest.labels[0].innerText = "Current Location is not available:'" + message + "'";
  radio_dest.checked = false;
  home_dest.checked = true;
}

function radioPosition(position) {
  lat = position.coords.latitude.toPrecision(7);
  lon = position.coords.longitude.toPrecision(7); 
  var radio  = document.getElementById("source_current_location");
  radio.value = lat + ", " + lon;
  radio.labels[0].innerText = "Current Location (" + lat + ", " + lon + ")";
  var radio_dest  = document.getElementById("dest_current_location");
  radio_dest.value = lat + ", " + lon;
  radio_dest.labels[0].innerText = "Current Location (" + lat + ", " + lon + ")";
}

function radioError(error) {
  switch(error.code) {
    case error.PERMISSION_DENIED:
      disableCurrentLocation("Permission Denied")
        break;
    case error.POSITION_UNAVAILABLE:
      disableCurrentLocation("Position Unavailable")
        break;
    case error.TIMEOUT:
      disableCurrentLocation("Timeout")
        break;
    case error.UNKNOWN_ERROR:
      disableCurrentLocation("Unknown Error")
        break;
  }
}

function getRoutes(){
  console.log("getRoutes() start.");
  var source_val = "";
  var dest_val = "";

#js_get_routes_src

#js_get_routes_dest

  if (source_val == "") {
    alert("Please Choose a Source.");
  }
  else if (dest_val == "") {
    alert("Please Choose a Destination.");
  }
  else {
    console.log("loading routes");
    console.log("src:"+source_val+" dest:"+dest_val);
    var res = document.getElementById("result_div");
    res.innerHTML = '<iframe src=\"?genmail[&quot;' + source_val + '&quot;;&quot;' + dest_val + '&quot;]\" width=1000 height=600/>';
  }

 console.log("getRoutes() end.");

}

</script>
</body>
</html>
